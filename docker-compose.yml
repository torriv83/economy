services:
  app:
    image: debt-manager:latest
    container_name: debt-manager-app
    restart: unless-stopped
    ports:
      - "27270:80"
    volumes:
      - sqlite-data:/var/www/storage/database
    networks:
      - debt-manager
    environment:
      - APP_ENV=production
      - DB_CONNECTION=sqlite
      - DB_DATABASE=/var/www/storage/database/database.sqlite
      - CACHE_STORE=redis
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - REDIS_PASSWORD=null
    depends_on:
      - redis

  redis:
    image: redis:alpine
    container_name: debt-manager-redis
    restart: unless-stopped
    networks:
      - debt-manager
    volumes:
      - redis-data:/data

  # queue:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #   container_name: debt-manager-queue
  #   restart: unless-stopped
  #   working_dir: /var/www
  #   volumes:
  #     - ./:/var/www
  #     - sqlite-data:/var/www/database
  #   command: php artisan queue:work --sleep=3 --tries=3
  #   depends_on:
  #     - app
  #     - redis
  #   networks:
  #     - debt-manager
  #   environment:
  #     - APP_ENV=production
  #     - DB_CONNECTION=sqlite
  #     - DB_DATABASE=/var/www/database/database.sqlite

  # scheduler:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #   container_name: debt-manager-scheduler
  #   restart: unless-stopped
  #   working_dir: /var/www
  #   volumes:
  #     - ./:/var/www
  #     - sqlite-data:/var/www/database
  #   command: php artisan schedule:work
  #   depends_on:
  #     - app
  #   networks:
  #     - debt-manager
  #   environment:
  #     - APP_ENV=production
  #     - DB_CONNECTION=sqlite
  #     - DB_DATABASE=/var/www/database/database.sqlite

networks:
  debt-manager:
    driver: bridge

volumes:
  sqlite-data:
    driver: local
  redis-data:
    driver: local
